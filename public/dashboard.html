<!DOCTYPE html>
<html>
<head>
  <title>Gallery</title>
  <link rel="stylesheet" href="style.css">
</head>
<body oncontextmenu="return false">

<div class="container">
  <div class="top-bar">
    <h1>Gallery</h1>
    <input id="search" placeholder="Search..." />
    <a href="/logout">Logout</a>
  </div>

  <div id="gallery"></div>
  <button id="more">Load more</button>
</div>

<script>
let page = 0;
const PAGE_SIZE = 2;
let albumsCache = [];

async function loadAll() {
  const res = await fetch('/media');
  albumsCache = await res.json();
  render();
}

function render() {
  const q = document.getElementById('search').value.toLowerCase();
  const container = document.getElementById('gallery');
  container.innerHTML = '';

  albumsCache
    .filter(a => a.album.toLowerCase().includes(q))
    .slice(0, (page + 1) * PAGE_SIZE)
    .forEach(a => {
      container.innerHTML += `<h2>${a.album}</h2><div class="grid">`;
      a.files.forEach(f => {
        container.innerHTML += f.match(/\.(mp4|webm)$/)
          ? `<video src="/media/${a.album}/${f}" controls controlsList="nodownload"></video>`
          : `<img src="/media/${a.album}/${f}" draggable="false" />`;
      });
      container.innerHTML += `</div>`;
    });
}

document.getElementById('search').oninput = () => {
  page = 0;
  render();
};

document.getElementById('more').onclick = () => {
  page++;
  render();
};

loadAll();
</script>
</body>
</html>
