<script>
  let allVideos = [];

  async function loadVideos() {
    const stateEl = document.getElementById('adminState');
    const container = document.getElementById('adminVideos');

    stateEl.textContent = 'Loading videosâ€¦';
    container.innerHTML = '';

    const res = await fetch('/videos');
    if (!res.ok) {
      window.location.href = '/login.html';
      return;
    }

    const data = await res.json();
    allVideos = data;

    if (!data.length) {
      stateEl.textContent = 'No videos uploaded yet.';
      return;
    }

    stateEl.textContent = '';
    renderAdminVideos(data);
  }

  function renderAdminVideos(videos) {
    const container = document.getElementById('adminVideos');
    container.innerHTML = '';

    videos.forEach(v => {
      const fileName = v.name;

      const card = document.createElement('div');
      card.className = 'video-card';

      const videoEl = document.createElement('video');
      videoEl.src = `/stream/${encodeURIComponent(fileName)}`;
      videoEl.controls = true;

      const title = document.createElement('div');
      title.textContent = fileName;

      const delBtn = document.createElement('button');
      delBtn.textContent = 'Delete';
      delBtn.onclick = async () => {
        if (!confirm(`Delete ${fileName}?`)) return;
        const res = await fetch(`/delete-video/${encodeURIComponent(fileName)}`, {
          method: 'DELETE',
        });
        if (res.ok) {
          loadVideos();
        } else {
          alert('Failed to delete.');
        }
      };

      card.appendChild(videoEl);
      card.appendChild(title);
      card.appendChild(delBtn);
      container.appendChild(card);
    });
  }

  // INIT
  loadVideos();
</script>
