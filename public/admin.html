<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Admin â€“ YVideo</title>
</head>
<body>
  <h2>Admin Panel</h2>
  <a href="/logout">Logout</a>

  <hr />
  <h3>Upload Video</h3>

  <form action="/upload" method="POST" enctype="multipart/form-data">
    <input type="file" name="video" accept="video/*" required />
    <button type="submit">Upload</button>
  </form>

  <hr />
  <h3>Videos</h3>
  <div id="status">Loading...</div>
  <div id="videos"></div>

  <script>
    async function loadVideos() {
      const status = document.getElementById('status');
      const container = document.getElementById('videos');

      const res = await fetch('/videos');
      if (!res.ok) {
        status.textContent = 'Not authorized';
        return;
      }

      const videos = await res.json();
      container.innerHTML = '';

      if (!videos.length) {
        status.textContent = 'No videos uploaded';
        return;
      }

      status.textContent = '';

      videos.forEach(v => {
        const div = document.createElement('div');

        const video = document.createElement('video');
        video.src = `/stream/${encodeURIComponent(v.name)}`;
        video.controls = true;
        video.width = 300;

        const del = document.createElement('button');
        del.textContent = 'Delete';
        del.onclick = async () => {
          if (!confirm('Delete this video?')) return;
          await fetch(`/delete-video/${encodeURIComponent(v.name)}`, {
            method: 'DELETE'
          });
          loadVideos();
        };

        div.appendChild(video);
        div.appendChild(document.createElement('br'));
        div.appendChild(del);
        div.appendChild(document.createElement('hr'));

        container.appendChild(div);
      });
    }

    loadVideos();
  </script>
</body>
</html>
